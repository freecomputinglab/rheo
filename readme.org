#+ATTR_HTML: :alt Project header :align center :width 600px
[[./header.png]]

rheo is a static site and experimental typesetting engine based on Typst that compiles entire folders of Typst documents to PDF, HTML, and EPUB simultaneously. It provides first-class support for both HTML and PDF with experimental EPUB support, and includes a development server for rapid HTML iteration.

** Usage
rheo is a command-line tool for batch-compiling Typst documents to multiple output formats.

*** Start developing a project

Compile all =.typ= files in a directory to PDF, HTML, and EPUB:

#+begin_src bash
rheo watch examples/blog_site --open
#+end_src

The =--open= flag starts a development server at =http://localhost:3000= with automatic browser refresh. When you edit any Typst file, the browser automatically reloads to show your changes. This provides a seamless development experience for HTML output.

Compile to specific formats:

#+begin_src bash
# PDF only
rheo compile examples/blog_site --pdf

# HTML only
rheo compile examples/blog_site --html
#+end_src

Use additional flags for customization:

#+begin_src bash
# Custom config file location
rheo compile examples/blog_site --config /path/to/custom.toml

# Custom build directory
rheo compile examples/blog_site --build-dir /tmp/build
#+end_src

Output is organized in each project's =build= directory: =build/pdf/=, =build/html/=, and =build/epub/=.

*** Clean Build Artifacts

Remove build artifacts:

#+begin_src bash
# For current directory
rheo clean

# For a specific project
rheo clean examples/web_book
#+end_src

*** Logging

Control output verbosity:

#+begin_src bash
# Quiet mode (errors only)
rheo compile examples/web_book --quiet

# Verbose mode (debug information)
rheo compile examples/web_book --verbose

# Trace-level logging
RUST_LOG=rheo=trace rheo compile examples/web_book
#+end_src

** Installation

*** Using cargo (Recommended)
rheo requires Rust and Cargo. Install from [[https://rustup.rs/][rustup.rs]].

#+begin_src bash
# Build the project
cargo build --release

# Install locally
cargo install --path .
#+end_src


*** Using Nix flakes
To install the compilation environment, first ensure that you have [[https://nixos.org/download/][Nix]] installed on your computer.
You will also need to enable [[https://nixos.wiki/wiki/Flakes][Nix flakes]], which you can do by inserting the following line in your ~nix.conf~:

#+begin_src conf
experimental-features = nix-command flakes
#+end_src

With Nix and flakes installed, run:

#+begin_src bash
# Enter development environment
nix develop

# Or build the package
nix build
#+end_src

This might take a while the first time, as Nix is installing typst from upstream and all the other necessary software.

** Link Transformation

rheo automatically transforms cross-document links based on the output format to ensure they work correctly in each context.

Relative =.typ= links are handled as follows:
- **PDF**: Removed from output, preserving only the link text (since Typst files won't exist output)
- **HTML**: Transformed to =.html= links with validation that linked files exist and are within project boundaries
- **External links** (HTTP, HTTPS, mailto): Preserved identically in all formats
- **Fragment links** (anchors within the same document): Preserved in all formats

Example Typst source:

#+begin_src typst
See the #link("./about.typ")[about page] for more information.
Visit #link("https://example.com")[our website].
#+end_src

Compiles to PDF as: "See the about page for more information. Visit our website."

Compiles to HTML as: `See the <a href="./about.html">about page</a> for more information. Visit <a href="https://example.com">our website</a>.`

If a linked file doesn't exist, rheo will report a detailed error during compilation.

** Features

*** Multi-Format Compilation

rheo compiles Typst documents to three output formats simultaneously:

- **PDF**: High-quality print-ready documents
- **HTML**: Web-ready output with CSS customization
- **EPUB**: E-book format with support for merged multi-chapter books

By default, all three formats are generated. Use format flags to compile specific outputs:

#+begin_src bash
rheo compile my_project --pdf       # PDF only
rheo compile my_project --html      # HTML only
rheo compile my_project --epub      # EPUB only
rheo compile my_project --pdf --html  # PDF and HTML
#+end_src

*** Watch Mode with Live Reload

Watch mode automatically recompiles files when they change, perfect for iterative development:

#+begin_src bash
rheo watch examples/blog_site
#+end_src

Add the =--open= flag to launch a development server with automatic browser refresh:

#+begin_src bash
rheo watch examples/blog_site --open
#+end_src

The development server:
- Runs at =http://localhost:3000=
- Opens your default browser automatically
- Refreshes the page when files change
- Supports multiple connected browsers

*** PDF and EPUB Merge

Combine multiple Typst files into a single PDF or EPUB document using the merge feature. Configure in =rheo.toml=:

#+begin_src toml
[pdf.merge]
title = "My Book"
spine = ["cover.typ", "chapters/**/*.typ"]

[epub.merge]
title = "My Book"
spine = ["cover.typ", "chapters/**/*.typ"]
#+end_src

The =spine= field uses glob patterns to specify which files to include and in what order (lexicographic sorting).

*** Automatic Defaults for EPUB

When no =rheo.toml= exists, rheo automatically infers sensible defaults for EPUB:

- **Title**: Derived from filename (single file) or directory name (project)
- **Spine**: Single file (single-file mode) or all =.typ= files sorted alphabetically (directory mode)

This means you can generate EPUBs without any configuration:

#+begin_src bash
rheo compile my_document.typ --epub
# Creates my_document.epub with title "My Document"

rheo compile my_book/ --epub
# Creates my_book.epub with all .typ files included
#+end_src

** Configuration

*** rheo.toml Basics

Projects can include a =rheo.toml= configuration file in the project root to customize compilation behavior.

**Minimal example:**

#+begin_src toml
content_dir = "content"
formats = ["html", "pdf"]
#+end_src

**Common configuration options:**

#+begin_src toml
# Project structure
content_dir = "content"      # Directory containing .typ files
build_dir = "build"          # Output directory (default: "build")

# Default formats when no CLI flags specified
formats = ["html", "pdf", "epub"]

# HTML customization
[html]
stylesheets = ["style.css", "custom.css"]
fonts = ["https://fonts.googleapis.com/css2?family=Inter"]

# PDF merge configuration
[pdf.merge]
title = "My Book"
spine = ["cover.typ", "chapters/**/*.typ"]

# EPUB merge configuration
[epub.merge]
title = "My Book"
spine = ["cover.typ", "chapters/**/*.typ"]
#+end_src

**Configuration precedence:**
1. CLI flags (=--pdf=, =--html=, =--epub=, =--config=, =--build-dir=) override everything
2. =rheo.toml= settings apply when no CLI flags specified
3. Built-in defaults apply when field not specified

** Customization

*** CSS Styling

rheo automatically looks for =style.css= in your project root and injects it into HTML output. Customize the HTML appearance by creating this file:

#+begin_src css
/* style.css */
body {
  max-width: 800px;
  margin: 0 auto;
  font-family: 'Inter', sans-serif;
}
#+end_src

Inject additional stylesheets via =rheo.toml=:

#+begin_src toml
[html]
stylesheets = ["style.css", "syntax-highlighting.css", "custom.css"]
#+end_src

Stylesheet paths are relative to =build/html/= directory.

*** External Fonts

Add web fonts to HTML output:

#+begin_src toml
[html]
fonts = [
  "https://fonts.googleapis.com/css2?family=Inter:wght@400;700",
  "https://fonts.googleapis.com/css2?family=JetBrains+Mono"
]
#+end_src

Font URLs are injected into the HTML =<head>= element.

*** rheo.typ Template

rheo automatically injects =src/typ/rheo.typ= into all compiled documents, providing helper functions and utilities. This template can define:

- Custom document formatting
- Reusable components (lemmas, theorems, callouts)
- Project-wide styling
- Helper functions

The template is automatically available in all =.typ= files without explicit imports.

** Examples

*** Single-File Compilation

Compile a single document to all formats:

#+begin_src bash
rheo compile my_document.typ
#+end_src

Output:
- =build/pdf/my_document.pdf=
- =build/html/my_document.html=
- =build/epub/my_document.epub=

*** Directory Compilation

Compile all =.typ= files in a directory:

#+begin_src bash
rheo compile examples/blog_site
#+end_src

Each =.typ= file generates separate PDF, HTML, and EPUB outputs (unless merge is configured).

*** Multi-Chapter Book

Create a merged book from multiple chapters:

1. Create =rheo.toml=:
#+begin_src toml
content_dir = "chapters"

[pdf.merge]
title = "My Complete Book"
spine = ["00-preface.typ", "*.typ", "99-appendix.typ"]

[epub.merge]
title = "My Complete Book"
spine = ["00-preface.typ", "*.typ", "99-appendix.typ"]
#+end_src

2. Compile:
#+begin_src bash
rheo compile . --pdf --epub
#+end_src

Output: Single =my_complete_book.pdf= and =my_complete_book.epub= with all chapters merged.
